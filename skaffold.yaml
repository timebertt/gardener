apiVersion: skaffold/v2beta25
kind: Config
build:
  artifacts:
  - image: eu.gcr.io/gardener-project/gardener/extensions/provider-local
    docker:
      dockerfile: Dockerfile
      target: gardener-extension-provider-local
    sync:
      infer:
      - charts/gardener/provider-local
  local:
    useBuildkit: true
deploy:
  helm:
    releases:
    - name: gardener-extension-provider-local
      chartPath: charts/gardener/provider-local/extension
      namespace: extension-provider-local
      createNamespace: true
      wait: true
      artifactOverrides:
        image: eu.gcr.io/gardener-project/gardener/extensions/provider-local
      imageStrategy:
        helm: {}
      overrides:
        strategy:
          type: Recreate # needed for mounting host's /etc/hosts file
          rollingUpdate: null
        extraVolumes:
        - name: hosts
          hostPath:
            path: /host/etc/hosts
            type: FileOrCreate
        extraVolumeMounts:
        - name: hosts
          mountPath: /host/etc/hosts
        controllers:
          dnsrecord:
            hostsFile: /host/etc/hosts
          service:
            hostIP: 192.168.0.102
        coredns:
          service:
            type: NodePort
            nodePort: 30353
